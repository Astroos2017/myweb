<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QR Code 產生器｜置中 Logo 可縮放</title>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  <style>
    body { font-family: sans-serif; background:#f7f7f7; margin:0; padding:20px; }
    .container { display:flex; gap:20px; }
    .controls { width:300px; background:#fff; padding:20px; border-radius:10px; box-shadow:0 0 5px rgba(0,0,0,.2); }
    canvas { background:#fff; border:1px solid #ddd; border-radius:10px; }
    label { display:block; margin-top:10px; font-size:14px; }
    input[type=text], input[type=number], input[type=url], input[type=file] { width:100%; padding:6px; margin-top:5px; }
    input[type=range] { width:100%; }
    button { margin-top:10px; padding:8px 12px; border:none; border-radius:5px; cursor:pointer; background:#4cc9f0; color:#fff; font-weight:bold; }
    button:hover { filter:brightness(1.1); }
  </style>
</head>
<body>
  <h1>QR Code 產生器（含 Logo）</h1>
  <div class="container">
    <div class="controls">
      <label>內容文字或網址</label>
      <input id="text" type="text" value="https://example.com" />

      <label>尺寸 (px)</label>
      <input id="size" type="number" value="400" min="100" max="1000" />

      <label>Logo 檔案</label>
      <input id="logoFile" type="file" accept="image/*" />

      <label>Logo 大小 (% 相對於 QR Code)</label>
      <input id="logoSize" type="range" min="0" max="40" step="1" value="20" />
      <span id="logoSizeVal">20%</span>

      <button id="btnGen">重新產生</button>
      <button id="btnDownload">下載 PNG</button>
    </div>
    <div>
      <canvas id="qrCanvas" width="400" height="400"></canvas>
    </div>
  </div>

  <script>
    const textEl = document.getElementById('text');
    const sizeEl = document.getElementById('size');
    const logoFileEl = document.getElementById('logoFile');
    const logoSizeEl = document.getElementById('logoSize');
    const logoSizeVal = document.getElementById('logoSizeVal');
    const canvas = document.getElementById('qrCanvas');
    const ctx = canvas.getContext('2d');

    let logoImage = null;

    logoFileEl.addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        const img = new Image();
        img.onload = () => { logoImage = img; generate(); };
        img.src = reader.result;
      };
      reader.readAsDataURL(file);
    });

    logoSizeEl.addEventListener('input', () => {
      logoSizeVal.textContent = logoSizeEl.value + '%';
      generate();
    });

    async function generate() {
      const text = textEl.value || '';
      const size = parseInt(sizeEl.value) || 400;
      canvas.width = size;
      canvas.height = size;

      // 先生成 QR Code 到暫存 canvas
      await QRCode.toCanvas(canvas, text, { width: size, margin: 2, errorCorrectionLevel: 'H' });

      // 疊上 Logo
      if (logoImage) {
        const logoPct = parseInt(logoSizeEl.value) / 100;
        const logoSize = size * logoPct;
        const x = (size - logoSize) / 2;
        const y = (size - logoSize) / 2;
        ctx.drawImage(logoImage, x, y, logoSize, logoSize);
      }
    }

    document.getElementById('btnGen').addEventListener('click', generate);

    document.getElementById('btnDownload').addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = 'qrcode.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    });

    // 初始生成
    generate();
  </script>
</body>
</html>
